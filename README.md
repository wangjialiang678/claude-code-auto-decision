# Claude Code è‡ªåŠ¨å†³ç­–ç³»ç»Ÿ

ä¸€å¥—åŸºäº Hooks çš„è‡ªåŠ¨å†³ç­–ç³»ç»Ÿï¼Œèƒ½å¤Ÿæ ¹æ®è§„åˆ™è‡ªåŠ¨æ‰¹å‡†/æ‹’ç»å·¥å…·è°ƒç”¨ï¼Œå¹¶ä»ç”¨æˆ·è¡Œä¸ºä¸­å­¦ä¹ ç”Ÿæˆæ–°è§„åˆ™ã€‚

## ç³»ç»Ÿæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         å­¦ä¹ é—­ç¯                                 â”‚
â”‚                                                                 â”‚
â”‚   è§‚å¯Ÿè¡Œä¸º â†’ è®°å½•åé¦ˆ â†’ æ£€æµ‹æ¨¡å¼ â†’ ç”Ÿæˆè§„åˆ™ â†’ è‡ªåŠ¨å†³ç­–           â”‚
â”‚       â†‘                                           â”‚             â”‚
â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    å…¨å±€ vs é¡¹ç›®è§„åˆ™å­˜å‚¨                          â”‚
â”‚                                                                 â”‚
â”‚   æ£€æµ‹åˆ°æ–°è§„åˆ™ â†’ æ™ºèƒ½åˆ¤æ–­ scope                                  â”‚
â”‚                       â†“                                         â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚   â”‚  scope=project     â”‚  scope=global          â”‚              â”‚
â”‚   â”‚  ç›´æ¥ä¿å­˜          â”‚  æç¤ºç”¨æˆ·ç¡®è®¤          â”‚              â”‚
â”‚   â”‚  ğŸ“ é¡¹ç›®è§„åˆ™       â”‚  ğŸŒ å¾…ç¡®è®¤é˜Ÿåˆ—         â”‚              â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚                                                                 â”‚
â”‚   ç”¨æˆ·å›å¤: ã€ŒåŒæ„å…¨å±€ã€â†’ ä¿å­˜å…¨å±€                               â”‚
â”‚            ã€Œä»…æœ¬é¡¹ç›®ã€â†’ ä¿å­˜é¡¹ç›®                               â”‚
â”‚            ã€Œå¿½ç•¥ã€    â†’ ä¸ä¿å­˜                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## æ–‡ä»¶ç»“æ„

```
~/.claude/
â”œâ”€â”€ settings.json                         # hooks é…ç½®
â”œâ”€â”€ auto-decision/
â”‚   â”œâ”€â”€ config.json                       # ç³»ç»Ÿé…ç½®
â”‚   â””â”€â”€ pending_global_rules.json         # å¾…ç¡®è®¤çš„å…¨å±€è§„åˆ™é˜Ÿåˆ—
â”œâ”€â”€ hooks/
â”‚   â”œâ”€â”€ auto_decision.py                  # PreToolUse: å†³ç­–+è®°å½•
â”‚   â”œâ”€â”€ feedback_collector.py             # PostToolUse: æ ‡è®°æ‰§è¡Œ
â”‚   â”œâ”€â”€ experience_saver.py               # PostToolUse: å­¦ä¹ è§„åˆ™
â”‚   â”œâ”€â”€ context_injector.py               # UserPromptSubmit: ä¸Šä¸‹æ–‡æ³¨å…¥
â”‚   â”œâ”€â”€ session_reviewer.py               # Stop: ä¼šè¯æ€»ç»“
â”‚   â””â”€â”€ lib/
â”‚       â”œâ”€â”€ __init__.py                   # è·¯å¾„å¸¸é‡
â”‚       â”œâ”€â”€ rules.py                      # è§„åˆ™è§£æåŒ¹é…
â”‚       â”œâ”€â”€ storage.py                    # æ•°æ®è¯»å†™
â”‚       â”œâ”€â”€ patterns.py                   # æ¨¡å¼æ£€æµ‹ + æ™ºèƒ½scopeåˆ¤æ–­
â”‚       â””â”€â”€ llm.py                        # LLM å¢å¼ºï¼ˆå¯é€‰ï¼Œæ”¯æŒ claude CLIï¼‰
â”œâ”€â”€ memory-bank/
â”‚   â”œâ”€â”€ profile.md                        # å…¨å±€ç”¨æˆ·ç”»åƒ
â”‚   â”œâ”€â”€ rules.md                          # å…¨å±€åŸºç¡€è§„åˆ™
â”‚   â””â”€â”€ learned-rules.md                  # å…¨å±€å­¦ä¹ è§„åˆ™
â””â”€â”€ skills/
    â”œâ”€â”€ rule-editor/SKILL.md              # è§„åˆ™ç¼–è¾‘ + å¾…ç¡®è®¤å¤„ç†
    â”œâ”€â”€ experience-learner/SKILL.md       # ç»éªŒåˆ†æçŸ¥è¯†
    â””â”€â”€ workflow-guide/SKILL.md           # å·¥ä½œæµæŒ‡å¯¼

.claude/memory-bank/  (é¡¹ç›®çº§)
â”œâ”€â”€ rules.md                              # é¡¹ç›®åŸºç¡€è§„åˆ™
â”œâ”€â”€ learned-rules.md                      # é¡¹ç›®å­¦ä¹ è§„åˆ™
â”œâ”€â”€ learnings/
â”‚   â”œâ”€â”€ experience-library.md             # é¡¹ç›®ç»éªŒåº“
â”‚   â””â”€â”€ error-patterns.json               # é¡¹ç›®é”™è¯¯æ¨¡å¼
â”œâ”€â”€ feedback/
â”‚   â””â”€â”€ {date}.jsonl                      # æ¯æ—¥åé¦ˆæ—¥å¿—
â””â”€â”€ sessions/
    â””â”€â”€ {session-id}.md                   # ä¼šè¯æ€»ç»“
```

## Hook å·¥ä½œæµç¨‹

```
ç”¨æˆ·è¾“å…¥æ¶ˆæ¯
      â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ UserPromptSubmit: context_injector.py                       â”‚
â”‚   1. æ£€æµ‹ä»»åŠ¡ç±»å‹ï¼ˆå®ç°/ç ”ç©¶/ç®€å•å¯¹è¯ï¼‰                       â”‚
â”‚   2. å®ç°ç±»ä»»åŠ¡ â†’ æ³¨å…¥é«˜é¢‘é”™è¯¯æé†’ + æ ¸å¿ƒæ•™è®­                â”‚
â”‚   3. ç ”ç©¶ç±»ä»»åŠ¡ â†’ åªæ³¨å…¥æ ¸å¿ƒæ•™è®­                             â”‚
â”‚   4. ç®€å•å¯¹è¯   â†’ ä¸æ³¨å…¥                                    â”‚
â”‚   5. å¦‚æœ‰è¿›è¡Œä¸­çš„è®¡åˆ’ â†’ æ³¨å…¥è®¡åˆ’æé†’                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â†“
Claude è°ƒç”¨å·¥å…·
      â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PreToolUse: auto_decision.py                                â”‚
â”‚   1. åŠ è½½è§„åˆ™ï¼ˆä¼˜å…ˆçº§è§ä¸‹è¡¨ï¼‰                                â”‚
â”‚   2. åŒ¹é…è§„åˆ™ â†’ è¿”å› allow/deny/ask                         â”‚
â”‚   3. [å¯é€‰] è§„åˆ™æœªå‘½ä¸­æ—¶è°ƒç”¨ LLM å†³ç­–                        â”‚
â”‚   4. è®°å½•è¯·æ±‚ â†’ feedback/{date}.jsonl                       â”‚
â”‚   5. è¾“å‡ºå†³ç­– JSONï¼ˆallow/denyï¼‰æˆ–ä¸è¾“å‡ºï¼ˆaskï¼‰              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â†“
[å¦‚æœ ask] ç”¨æˆ·çœ‹åˆ°å¼¹æ¡† â†’ ç‚¹å‡» Yes/No
      â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PostToolUse: feedback_collector.py                          â”‚
â”‚   - åªæœ‰æ‰§è¡ŒæˆåŠŸæ‰è§¦å‘ï¼ˆè¯´æ˜ç”¨æˆ·ç‚¹äº† Yesï¼‰                    â”‚
â”‚   - æ›´æ–° feedback æ—¥å¿—ï¼šexecuted = true                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PostToolUse: experience_saver.py                            â”‚
â”‚   - æ¯ 10 æ¬¡è°ƒç”¨è¿è¡Œä¸€æ¬¡æ¨¡å¼æ£€æµ‹                             â”‚
â”‚   - åˆ†æ feedback æ—¥å¿—ï¼Œæ‰¾å‡ºé‡å¤æ¨¡å¼                         â”‚
â”‚   - æ™ºèƒ½åˆ¤æ–­ scopeï¼ˆå…¨å±€ or é¡¹ç›®ï¼‰                           â”‚
â”‚   - å…¨å±€è§„åˆ™ â†’ æ˜¾ç¤ºç¡®è®¤æ¡†ï¼Œç”¨æˆ·å›å¤åå¤„ç†                    â”‚
â”‚   - é¡¹ç›®è§„åˆ™ â†’ ç›´æ¥ä¿å­˜åˆ° learned-rules.md                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â†“
ä¼šè¯ç»“æŸæ—¶
      â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Stop: session_reviewer.py                                   â”‚
â”‚   - ç»Ÿè®¡æœ¬æ¬¡ä¼šè¯å†³ç­–æƒ…å†µ                                     â”‚
â”‚   - [å¯é€‰] ç”¨ LLM ç”Ÿæˆæ€»ç»“                                   â”‚
â”‚   - å†™å…¥ sessions/{session-id}.md                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## å†³ç­–è¾“å‡ºæ ¼å¼

Hook é€šè¿‡ stdout è¾“å‡º JSON æ§åˆ¶ Claude Code è¡Œä¸ºï¼š

```json
// è‡ªåŠ¨æ‰¹å‡†
{
  "hookSpecificOutput": {
    "hookEventName": "PreToolUse",
    "permissionDecision": "allow",
    "permissionDecisionReason": "è§„åˆ™è¯´æ˜"
  }
}

// è‡ªåŠ¨æ‹’ç»
{
  "hookSpecificOutput": {
    "hookEventName": "PreToolUse",
    "permissionDecision": "deny",
    "permissionDecisionReason": "æ‹’ç»åŸå› "
  }
}

// è®©ç”¨æˆ·ç¡®è®¤ï¼šä¸è¾“å‡ºä»»ä½•å†…å®¹ï¼Œèµ°æ­£å¸¸å¼¹æ¡†æµç¨‹
```

## è§„åˆ™æ ¼å¼ï¼ˆMarkdownï¼‰

è§„åˆ™æ–‡ä»¶ä½¿ç”¨ Markdown æ ¼å¼ï¼Œä¾¿äºäººç±»é˜…è¯»å’Œç¼–è¾‘ï¼š

```markdown
### rule-id
- tool: Bash
  action: allow
  pattern: ^npm test
  reason: æµ‹è¯•å‘½ä»¤æ˜¯å®‰å…¨çš„
```

### å­—æ®µè¯´æ˜

| å­—æ®µ | å¿…éœ€ | è¯´æ˜ |
|------|------|------|
| tool | æ˜¯ | å·¥å…·åï¼Œæ”¯æŒæ­£åˆ™å¦‚ `Write\|Edit` |
| action | æ˜¯ | `allow`ï¼ˆè‡ªåŠ¨æ‰¹å‡†ï¼‰ã€`deny`ï¼ˆè‡ªåŠ¨æ‹’ç»ï¼‰ã€`ask`ï¼ˆå¼¹æ¡†ç¡®è®¤ï¼‰ |
| pattern | å¦ | åŒ¹é…å‘½ä»¤å†…å®¹çš„æ­£åˆ™è¡¨è¾¾å¼ï¼ˆç”¨äº Bashï¼‰ |
| path | å¦ | åŒ¹é…æ–‡ä»¶è·¯å¾„çš„ glob æ¨¡å¼ï¼ˆç”¨äº Write/Edit/Readï¼‰ |
| reason | æ˜¯ | è§„åˆ™è¯´æ˜ï¼Œä¼šæ˜¾ç¤ºç»™ç”¨æˆ· |

### è§„åˆ™ä¼˜å…ˆçº§

| ä¼˜å…ˆçº§ | æ–‡ä»¶ä½ç½® | è¯´æ˜ |
|--------|---------|------|
| 1ï¼ˆæœ€é«˜ï¼‰ | é¡¹ç›® `learned-rules.md` | é¡¹ç›®å­¦ä¹ è§„åˆ™ |
| 2 | é¡¹ç›® `rules.md` | é¡¹ç›®æ‰‹åŠ¨è§„åˆ™ |
| 3 | å…¨å±€ `learned-rules.md` | å…¨å±€å­¦ä¹ è§„åˆ™ |
| 4ï¼ˆæœ€ä½ï¼‰ | å…¨å±€ `rules.md` | å…¨å±€æ‰‹åŠ¨è§„åˆ™ |

## åé¦ˆæ—¥å¿—æ ¼å¼ï¼ˆJSONLï¼‰

æ¯è¡Œä¸€ä¸ª JSON å¯¹è±¡ï¼š

```json
{
  "id": "tool_use_id",
  "ts": "2024-01-19T10:00:00",
  "session_id": "session_id",
  "tool": "Bash",
  "input": {"command": "npm test"},
  "auto_decision": "ask",
  "executed": true
}
```

| å­—æ®µ | è¯´æ˜ |
|------|------|
| auto_decision | ç³»ç»Ÿå†³ç­–ï¼š`allow`/`deny`/`ask` |
| executed | `true`=ç”¨æˆ·æ‰¹å‡†, `false`=ç”¨æˆ·æ‹’ç», `null`=å¾…ç¡®è®¤ |

**æ¨æ–­ç”¨æˆ·é€‰æ‹©**ï¼š`auto_decision=ask` ä¸” `executed=true` è¡¨ç¤ºç”¨æˆ·ç‚¹äº† Yesã€‚

## å­¦ä¹ æœºåˆ¶

### æ¨¡å¼æ£€æµ‹ç®—æ³•

```python
# æŒ‰å·¥å…·å’Œæ¨¡å¼åˆ†ç»„ç»Ÿè®¡
# Bash å‘½ä»¤æŒ‰å‰ç¼€åˆ†ç»„ï¼šnpm test, git status, etc.
# æ–‡ä»¶æ“ä½œæŒ‰æ‰©å±•ååˆ†ç»„ï¼š.ts, .env, etc.

if è¿ç»­ N æ¬¡ç›¸åŒé€‰æ‹© and ç½®ä¿¡åº¦ > é˜ˆå€¼:
    ç”Ÿæˆæ–°è§„åˆ™
```

### æ™ºèƒ½ Scope åˆ¤æ–­

æ£€æµ‹åˆ°æ–°è§„åˆ™åï¼Œè‡ªåŠ¨åˆ¤æ–­åº”è¯¥å­˜å…¨å±€è¿˜æ˜¯é¡¹ç›®ï¼š

| è§„åˆ™ç±»å‹ | åˆ¤å®šä¸º | ç†ç”± |
|---------|--------|------|
| Read/Glob/Grep ç­‰åªè¯»å·¥å…· | å…¨å±€ | åªè¯»æ“ä½œé€šå¸¸å…¨å±€ä¸€è‡´ |
| TodoWrite/AskUserQuestion | å…¨å±€ | é€šç”¨è¾…åŠ©å·¥å…· |
| å±é™©å‘½ä»¤ deny è§„åˆ™ | å…¨å±€ | æ‰€æœ‰é¡¹ç›®éƒ½åº”è¯¥æ‹’ç» |
| npm/pip/cargo ç­‰åŒ…ç®¡ç†å™¨ | é¡¹ç›® | ä¸åŒé¡¹ç›®æŠ€æœ¯æ ˆä¸åŒ |
| æ–‡ä»¶è·¯å¾„è§„åˆ™ | é¡¹ç›® | ä¸é¡¹ç›®ç»“æ„ç›¸å…³ |
| Write/Edit | é¡¹ç›® | ä¸é¡¹ç›®æ–‡ä»¶ç»“æ„ç›¸å…³ |
| å…¶ä»– | é¡¹ç›® | ä¿å®ˆç­–ç•¥ |

### å…¨å±€è§„åˆ™ç¡®è®¤

å½“æ£€æµ‹åˆ°é€‚åˆå…¨å±€çš„è§„åˆ™æ—¶ï¼Œä¼šæ˜¾ç¤ºç¡®è®¤æ¡†ï¼š

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘  ğŸŒ æ£€æµ‹åˆ°å¯èƒ½é€‚ç”¨äºã€å…¨å±€ã€‘çš„è§„åˆ™                        â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘  è§„åˆ™: Read â†’ allow                                      â•‘
â•‘  åŸå› : ç”¨æˆ·æ€»æ˜¯æ‰¹å‡† Read æ“ä½œ                            â•‘
â•‘  åˆ¤æ–­ä¾æ®: Read æ˜¯åªè¯»æ“ä½œï¼Œé€šå¸¸å…¨å±€ä¸€è‡´                  â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘  ğŸ’¬ è¯·å›å¤:                                              â•‘
â•‘     ã€ŒåŒæ„å…¨å±€ã€- ä¿å­˜ä¸ºå…¨å±€è§„åˆ™ï¼Œæ‰€æœ‰é¡¹ç›®ç”Ÿæ•ˆ            â•‘
â•‘     ã€Œä»…æœ¬é¡¹ç›®ã€- åªä¿å­˜åˆ°å½“å‰é¡¹ç›®                        â•‘
â•‘     ã€Œå¿½ç•¥ã€    - ä¸ä¿å­˜è¿™æ¡è§„åˆ™                          â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

ç”¨æˆ·ç›´æ¥ç”¨è‡ªç„¶è¯­è¨€å›å¤å³å¯ï¼Œæ— éœ€è®°å‘½ä»¤ã€‚

### å­¦ä¹ è§„åˆ™ç¤ºä¾‹

```markdown
### learned-20240119103000
- tool: Bash
  action: allow
  pattern: ^npm test
  reason: ç”¨æˆ·æ€»æ˜¯æ‰¹å‡† npm test
  confidence: 0.95
  learned_at: 2024-01-19
  based_on: æ‰¹å‡† 12 æ¬¡ï¼Œæ‹’ç» 0 æ¬¡
```

## é…ç½®æ–‡ä»¶

`~/.claude/auto-decision/config.json`:

```json
{
  "version": "1.0",
  "learning": {
    "enabled": true,
    "threshold": 3,
    "confidence_min": 0.8
  },
  "llm": {
    "enabled": false,
    "provider": "claude",
    "model": "haiku",
    "timeout": 30
  },
  "session_review": {
    "enabled": true,
    "min_actions": 5
  }
}
```

| é…ç½®é¡¹ | è¯´æ˜ |
|--------|------|
| learning.threshold | è¿ç»­å¤šå°‘æ¬¡ç›¸åŒé€‰æ‹©æ‰ç”Ÿæˆè§„åˆ™ |
| learning.confidence_min | æœ€å°ç½®ä¿¡åº¦é˜ˆå€¼ |
| llm.enabled | æ˜¯å¦å¯ç”¨ LLM å¢å¼º |
| llm.provider | `claude`ï¼ˆæ¨èï¼Œä½¿ç”¨ CLIï¼‰æˆ– `openai` |
| session_review.min_actions | æœ€å°‘å¤šå°‘æ¬¡æ“ä½œæ‰ç”Ÿæˆä¼šè¯æ€»ç»“ |

## Skills

ä¸‰ä¸ªè‡ªåŠ¨è§¦å‘çš„ Skillsï¼Œæ³¨å…¥ä¸“ä¸šçŸ¥è¯†ï¼š

| Skill | è§¦å‘æ¡ä»¶ | ä½œç”¨ |
|-------|---------|------|
| rule-editor | ç”¨æˆ·è°ˆè®º"è§„åˆ™"ã€"è‡ªåŠ¨å…è®¸" | æ•™ Claude å¦‚ä½•æ­£ç¡®ç¼–è¾‘è§„åˆ™æ–‡ä»¶ |
| experience-learner | ç”¨æˆ·æƒ³"åˆ†æä¹ æƒ¯"ã€"æŸ¥çœ‹å­¦ä¹ " | æ•™ Claude å¦‚ä½•åˆ†æåé¦ˆæ•°æ® |
| workflow-guide | æ–°ä¼šè¯ã€é—®å·¥ä½œæµ | RIPER-5 å·¥ä½œæµæŒ‡å¯¼ |

## settings.json é…ç½®

```json
{
  "hooks": {
    "PreToolUse": [
      {
        "matcher": ".*",
        "hooks": [
          {
            "type": "command",
            "command": "python3 ~/.claude/hooks/auto_decision.py"
          }
        ]
      }
    ],
    "PostToolUse": [
      {
        "matcher": ".*",
        "hooks": [
          {
            "type": "command",
            "command": "python3 ~/.claude/hooks/feedback_collector.py"
          },
          {
            "type": "command",
            "command": "python3 ~/.claude/hooks/experience_saver.py"
          }
        ]
      }
    ],
    "Stop": [
      {
        "hooks": [
          {
            "type": "command",
            "command": "python3 ~/.claude/hooks/session_reviewer.py"
          }
        ]
      }
    ]
  }
}
```

## é»˜è®¤è§„åˆ™

ç³»ç»Ÿé¢„ç½®çš„åŸºç¡€è§„åˆ™ï¼š

### å…è®¸ï¼ˆallowï¼‰

- `Read`, `Glob`, `Grep` - è¯»å–å’Œæœç´¢æ“ä½œ
- `WebSearch`, `WebFetch` - ç½‘ç»œæœç´¢
- `TodoWrite`, `AskUserQuestion` - è¾…åŠ©å·¥å…·
- `Bash`: `ls`, `pwd`, `cat`, `head`, `tail` ç­‰åªè¯»å‘½ä»¤
- `Bash`: `git status`, `git log`, `git diff` ç­‰ Git åªè¯»å‘½ä»¤
- `Bash`: `npm test`, `pytest`, `go test` ç­‰æµ‹è¯•å‘½ä»¤

### æ‹’ç»ï¼ˆdenyï¼‰

- `Bash`: `rm -rf /` æˆ– `rm -rf ~` - å±é™©åˆ é™¤
- `Write|Edit`: `**/.env*` - ç¯å¢ƒå˜é‡æ–‡ä»¶
- `Write`: `**/package-lock.json` - é”æ–‡ä»¶

### å…¶ä»–

- æœªåŒ¹é…è§„åˆ™çš„æ“ä½œ â†’ `ask`ï¼ˆå¼¹æ¡†ç¡®è®¤ï¼‰

## LLM å¢å¼ºï¼ˆå¯é€‰ï¼‰

å¯ç”¨åï¼Œåœ¨è§„åˆ™æœªå‘½ä¸­æ—¶è°ƒç”¨ LLMï¼š

1. **æ™ºèƒ½å†³ç­–**ï¼šåˆ†æä¸Šä¸‹æ–‡åˆ¤æ–­æ˜¯å¦æ‰¹å‡†
2. **æ³›åŒ–è§„åˆ™**ï¼šç”Ÿæˆæ›´é€šç”¨çš„è§„åˆ™ï¼ˆå¦‚åˆå¹¶ `npm test` å’Œ `npm run test`ï¼‰
3. **ä¼šè¯æ€»ç»“**ï¼šç”Ÿæˆè‡ªç„¶è¯­è¨€çš„ä¼šè¯æ€»ç»“

### é…ç½®æ–¹å¼

**æ¨èï¼šä½¿ç”¨ Claude CLIï¼ˆæ— éœ€é¢å¤–é…ç½®ï¼‰**

```json
{
  "llm": {
    "enabled": true,
    "provider": "claude",
    "model": "haiku"
  }
}
```

ç›´æ¥è°ƒç”¨ `claude` å‘½ä»¤ï¼Œåˆ©ç”¨å·²æœ‰çš„è®¤è¯ï¼Œæ— éœ€ API keyã€‚

**å¤‡é€‰ï¼šä½¿ç”¨ OpenAI**

```json
{
  "llm": {
    "enabled": true,
    "provider": "openai",
    "model": "gpt-4o-mini",
    "api_key_env": "OPENAI_API_KEY"
  }
}
```

éœ€è¦è®¾ç½®ç¯å¢ƒå˜é‡ `OPENAI_API_KEY`ã€‚

## ä½¿ç”¨æ–¹å¼

### è‡ªåŠ¨ç”Ÿæ•ˆ

é‡å¯ Claude Code åï¼Œhooks è‡ªåŠ¨åŠ è½½ã€‚

### è‡ªç„¶è¯­è¨€äº¤äº’

**é…ç½®è§„åˆ™**ï¼š
- "å¸®æˆ‘æŠŠ npm run build åŠ åˆ°è‡ªåŠ¨å…è®¸"
- "ç°åœ¨æœ‰å“ªäº›è§„åˆ™ï¼Ÿ"
- "åˆ†æä¸€ä¸‹æˆ‘çš„å†³ç­–ä¹ æƒ¯"

**å¤„ç†å…¨å±€è§„åˆ™ç¡®è®¤**ï¼ˆå½“çœ‹åˆ°ç¡®è®¤æ¡†æ—¶ï¼‰ï¼š
- è¯´ "åŒæ„å…¨å±€" æˆ– "å…¨å±€" â†’ ä¿å­˜ä¸ºå…¨å±€è§„åˆ™
- è¯´ "ä»…æœ¬é¡¹ç›®" æˆ– "é¡¹ç›®" â†’ ä¿å­˜ä¸ºé¡¹ç›®è§„åˆ™
- è¯´ "å¿½ç•¥" æˆ– "ç®—äº†" â†’ ä¸ä¿å­˜

### æŸ¥çœ‹å­¦ä¹ ç»“æœ

| å†…å®¹ | ä½ç½® |
|------|------|
| å…¨å±€è§„åˆ™ | `~/.claude/memory-bank/rules.md` |
| å…¨å±€å­¦ä¹ è§„åˆ™ | `~/.claude/memory-bank/learned-rules.md` |
| é¡¹ç›®è§„åˆ™ | `.claude/memory-bank/rules.md` |
| é¡¹ç›®å­¦ä¹ è§„åˆ™ | `.claude/memory-bank/learned-rules.md` |
| é¡¹ç›®ç»éªŒåº“ | `.claude/memory-bank/learnings/experience-library.md` |
| åé¦ˆæ—¥å¿— | `.claude/memory-bank/feedback/{date}.jsonl` |
| ä¼šè¯æ€»ç»“ | `.claude/memory-bank/sessions/{session-id}.md` |
| å¾…ç¡®è®¤å…¨å±€è§„åˆ™ | `~/.claude/auto-decision/pending_global_rules.json` |

## æŠ€æœ¯ç»†èŠ‚

### Claude Code å·¥å…·åˆ—è¡¨

| æ“ä½œ | å·¥å…·å |
|------|--------|
| è¯»å–æ–‡ä»¶ | Read |
| åˆ›å»ºæ–‡ä»¶ | Write |
| ç¼–è¾‘æ–‡ä»¶ | Edit |
| æœç´¢æ–‡ä»¶å | Glob |
| æœç´¢å†…å®¹ | Grep |
| æ‰§è¡Œå‘½ä»¤ | Bash |
| ç½‘ç»œæœç´¢ | WebSearch |
| è·å–ç½‘é¡µ | WebFetch |
| å¯åŠ¨å­ä»»åŠ¡ | Task |
| è¯¢é—®ç”¨æˆ· | AskUserQuestion |
| å†™å¾…åŠ | TodoWrite |

**æ³¨æ„**ï¼šåˆ é™¤ã€æ”¹åã€å®‰è£…ä¾èµ–ç­‰æ“ä½œéƒ½æ˜¯é€šè¿‡ `Bash` å·¥å…·æ‰§è¡Œçš„ã€‚

### ç”¨æˆ·é€‰æ‹©æ¨æ–­

Claude Code Hooks æ— æ³•ç›´æ¥æ•è·ç”¨æˆ·ç‚¹å‡» Yes/No çš„åŠ¨ä½œã€‚é€šè¿‡ä»¥ä¸‹æ–¹å¼æ¨æ–­ï¼š

```
PreToolUse è®°å½•è¯·æ±‚ â†’ auto_decision = "ask"
PostToolUse åªæœ‰æ‰§è¡ŒæˆåŠŸæ‰è§¦å‘ â†’ executed = true = ç”¨æˆ·æ‰¹å‡†
æœªè§¦å‘ PostToolUse â†’ executed ä¿æŒ null â†’ æ¨æ–­ä¸ºç”¨æˆ·æ‹’ç»
```

## æ‰©å±•å»ºè®®

1. **æ·»åŠ æ–°å·¥å…·æ”¯æŒ**ï¼šåœ¨ `rules.md` ä¸­æ·»åŠ å¯¹åº”è§„åˆ™
2. **è°ƒæ•´å­¦ä¹ çµæ•åº¦**ï¼šä¿®æ”¹ `config.json` çš„ `threshold` å’Œ `confidence_min`
3. **é¡¹ç›®ç‰¹å®šè§„åˆ™**ï¼šåœ¨é¡¹ç›®çš„ `.claude/memory-bank/rules.md` ä¸­å®šä¹‰
4. **ç¦ç”¨å­¦ä¹ **ï¼šè®¾ç½® `learning.enabled: false`
